<!DOCTYPE html>
<canvas id="ctx" width="900" height="500" style= "border:1px solid #000000;"></canvas>  
<script src = "https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
        var ctx = document.getElementById("ctx").getContext("2d");
    var Img = {};
    Img.player1 = new Image();
    Img.player1.src = '/client/img/Paddle1.png';
    Img.player2 = new Image();
    Img.player2.src = '/client/img/Paddle2.png';
    Img.ball = new Image();
    Img.ball.src = '/client/img/Ball.png'
    var spectating = false;
    var pregame = false;

    var socket = io();

        socket.on('newPositions', function(playerData, bulletData){
            //might have to remove clear rect here once ball update works
            ctx.clearRect(0,0,900,500);
            for(var i = 0; i < playerData.length; i++){
                if(i == 0)ctx.drawImage(Img.player1,playerData[i].x, playerData[i].y);
                else ctx.drawImage(Img.player2,playerData[i].x, playerData[i].y);
                //make sure ball only updates once per tick
                
            }
            for(var i = 0; i < bulletData.length; i++){
            ctx.drawImage(Img.ball, bulletData[i].x, bulletData[i].y);
            }
            // ctx.clearRect(50,0,50,500);
            // ctx.clearRect(800,0,50,500);
        });

        socket.on('pregame', function(){
            pregame = true;
            
            ctx.drawImage(Img.ball, 450, 250);
            
        });
        socket.on('gameBegin', function(){
            pregame = false;
        });

        // socket.on('ballUpdate', function(pos){
        //     pregame = false;
        //     // ctx.clearRect(0,0,900,500);
        //     ctx.drawImage(Img.ball, pos.x, pos.y);
        // });

        //tells user if they are just spectating and disable input to prevent server crash
        socket.on('spectate', function(){
            spectating = true;
            alert("You are spectating");
        });
        
        //key down listener and sender
        
            document.onkeydown = function(event){
            if(event.keyCode === 38 && spectating == false) //up arrow 
                socket.emit('keypress', {inputId:'up', state:true});
            else if(event.keyCode === 40 && spectating == false) //down Arrow
                socket.emit('keypress', {inputId:'down', state:true});
            else if(event.keyCode === 37 && spectating == false) //left Arrow
                socket.emit('keypress', {inputId:'left', state:true});
            else if(event.keyCode === 39 && spectating == false) //right Arrow
                socket.emit('keypress', {inputId:'right', state:true});
    }
        //key up listener and sender
            document.onkeyup = function(event){
            if(event.keyCode === 38 && spectating == false) //up arrow
                socket.emit('keypress', {inputId:'up', state:false});
            else if(event.keyCode === 40 && spectating == false) //down Arrow
                socket.emit('keypress', {inputId:'down', state:false});
                else if(event.keyCode === 37 && spectating == false) //left Arrow
                socket.emit('keypress', {inputId:'left', state:false});
            else if(event.keyCode === 39 && spectating == false) //right Arrow
                socket.emit('keypress', {inputId:'right', state:false});
        }

        //send click to sever 
        document.onclick = function(event){
            socket.emit('click');
        }
</script>